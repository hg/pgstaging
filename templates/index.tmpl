<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>–¢–µ—Å—Ç–æ–≤—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</title>
    <link rel="stylesheet" href="assets/bulma.min.css">
</head>
<body class="columns">

<main class="column is-three-quarters">
    <section class="section">
        <div class="container">
            <h1 class="title">–°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∞–∑</h1>

            <div class="table-container">
                <table class="table is-bordered is-striped">
                    <thead>
                    <tr>
                        <th>–ò–º—è</th>
                        <th>–ü–æ—Ä—Ç</th>
                        <th>–Æ–∑–µ—Ä</th>
                        <th>–ü–∞—Ä–æ–ª—å</th>
                        <th>URL</th>
                        <th>–ó–∞–ø—É—â–µ–Ω</th>
                        <th>
                            <abbr title="–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤, –∫–æ—Ç–æ—Ä–∞—è _–æ–±—ã—á–Ω–æ_ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è.">
                                –°–æ–∑–¥–∞–Ω
                            </abbr>
                        </th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                    </thead>

                    <tbody>
                    {{ range .Clusters }}
                        <tr>
                            <td>{{ .Name }}</td>
                            <td>{{ .Port }}</td>
                            <td>{{ or .User "‚Äî" }}</td>
                            {{ if .Secure }}
                                <td title="–°–æ–∑–¥–∞—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–∏–ª —Å–≤–æ–π –ø–∞—Ä–æ–ª—å">üîí</td>
                            {{ else }}
                                <td>{{ or .Pass "‚Äî" }}</td>
                            {{ end }}
                            {{ if not .Dev }}
                                <td>‚Äî</td>
                                <td>{{ if .Running }}‚úÖ{{ else }}‚ùå{{ end }}</td>
                                <td>{{ .Modified }}</td>
                                <td></td>
                            {{ else }}
                                <td>
                                    <code>postgres://{{ .User }}:{{ .Pass }}@{{ .Host }}:{{ .Port }}/sc</code>
                                </td>
                                <td>
                                    <form action="/api/modify" method="post">
                                        <input type="hidden" name="name" value="{{ .Name }}">
                                        {{ if .Secure }}
                                            <input type="hidden" name="password">
                                        {{ end }}
                                        {{ if .Running }}
                                            <input type="hidden" name="action" value="stop">
                                            <button type="submit" class="button is-warning is-small"
                                                    {{ if .Secure }}data-secured="" disabled{{ end }}
                                                    onclick="addLoading()">
                                                –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                                            </button>
                                        {{ else }}
                                            <input type="hidden" name="action" value="start">
                                            <button type="submit" class="button is-primary is-small"
                                                    {{ if .Secure }}data-secured="" disabled{{ end }}
                                                    onclick="addLoading()">
                                                –ó–∞–ø—É—Å—Ç–∏—Ç—å
                                            </button>
                                        {{ end }}
                                    </form>
                                </td>
                                <td>{{ .Modified }}</td>
                                <td>
                                    <form action="/api/modify" method="post" onsubmit="return deleteDb()">
                                        <input type="hidden" name="name" value="{{ .Name }}">
                                        <input type="hidden" name="action" value="drop">
                                        {{ if .Secure }}
                                            <input type="hidden" name="password">
                                        {{ end }}

                                        <button class="button is-danger is-small"
                                                {{ if .Secure }}data-secured="" disabled{{ end }}>
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </form>
                                </td>
                            {{ end }}
                        </tr>
                    {{ end }}

                    </tbody>
                </table>
            </div>

            <div class="block">
                <div class="field">
                    <label for="common-password" class="label">
                        –ü–∞—Ä–æ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏/–∑–∞–ø—É—Å–∫–∞/—É–¥–∞–ª–µ–Ω–∏—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –±–∞–∑
                    </label>
                    <div class="control">
                        <input id="common-password" type="password" class="input" name="common-password"
                               placeholder="–£–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å –ø–∞—Ä–æ–ª—å –¥–ª—è –Ω—É–∂–Ω–æ–π –±–∞–∑—ã, –∏ –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –£–¥–∞–ª–∏—Ç—å, –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, –∏–ª–∏ –ó–∞–ø—É—Å—Ç–∏—Ç—å"
                               oninput="setPasswords()">
                    </div>
                </div>
            </div>

            <div class="block">
                –°—Ç—Ä–æ–∫—É –∏–∑ <code>URL</code> –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≥–æ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏–π:
            </div>

            <pre>$ export DATABASE_URL=—Å—Ç—Ä–æ–∫–∞_–∏–∑_—Ç–∞–±–ª–∏—Ü—ã
$ dbmate status
$ dbmate up
</pre>
        </div>

    </section>

    <section class="section">
        <div class="container">

            <h1 class="title">–°–æ–∑–¥–∞—Ç—å –±–∞–∑—É</h1>

            <div class="content">
                <p>
                    –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã: <code>_</code>, <code>abcdefghijklmnopqrstuvwxyz</code>, <code>0123456789</code>.
                </p>

                <p>–í –∫–∞—á–µ—Å—Ç–≤–µ –∏–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á—Ç–æ-—Ç–æ –ø–æ–Ω—è—Ç–Ω–æ–µ:</p>

                <ol>
                    <li>–µ—Å–ª–∏ —ç—Ç–æ –≤–∞—à–∞ –ª–∏—á–Ω–∞—è –ø–µ—Å–æ—á–Ω–∏—Ü–∞ ‚Äî —Å–≤–æ—ë –∏–º—è: <code>divanov</code></li>
                    <li>–µ—Å–ª–∏ —ç—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ <code>#12345</code> ‚Äî —Ç–∞–∫ –∏ –Ω–∞–∑–æ–≤–∏—Ç–µ –±–∞–∑—É: <code>issue_12345</code>
                    </li>
                    <li>–µ—Å–ª–∏ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏ ‚Äî <code>appeals</code></li>
                </ol>

                <p>–ü–∞—Ä–æ–ª—å –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å ‚Äî —Ç–æ–≥–¥–∞ –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –µ—ë –±—É–¥–µ—Ç –∏–º–µ—Ç—å –ª—é–±–æ–π
                    –∂–µ–ª–∞—é—â–∏–π.</p>
            </div>

            <form action="/api/create" method="post">
                <div class="field">
                    <label for="name" class="label">
                        –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ø–∏–∏ PostgreSQL
                    </label>
                    <div class="control">
                        <input id="name" type="text" class="input" minlength="1" maxlength="32" name="name"
                               required placeholder="–ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∞—Ç–∏–Ω–∏—Ü–µ–π/—Ü–∏—Ñ—Ä–∞–º–∏">
                    </div>
                </div>

                <div class="field">
                    <label for="password" class="label">
                        –ü–∞—Ä–æ–ª—å –æ—Ç —é–∑–µ—Ä–∞ <code>sc</code> –∏ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è –±–∞–∑—ã
                    </label>
                    <div class="control">
                        <input id="password" type="password" class="input" name="password"
                               minlength="8" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –∑–∞—â–∏—Ç—ã –±–∞–∑—ã (–Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤)">
                    </div>
                </div>

                <div class="field">
                    <div class="control">
                        <button id="btn-create" class="button is-primary">
                            –°–æ–∑–¥–∞—Ç—å
                        </button>
                    </div>
                </div>
            </form>

        </div>
    </section>
</main>

<aside class="column">
    {{ range .Events }}
        <div class="notification {{ if eq .Status "error" }}is-danger{{ else if eq .Status "queued" }}is-info{{ else }}is-success{{ end }} m-1">
            <h1 class="is-size-5 has-text-weight-bold">
                {{ if eq .Status "error" }}
                    –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É
                {{ else if eq .Status "queued" }}
                    –ó–∞–¥–∞—á–∞ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å
                {{ else if eq .Status "success" }}
                    –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
                {{ end }}
            </h1>
            <h2 class="is-size-6">
                {{ .When.Format "02.01.2006 15:04:05" }}
            </h2>
            {{ if ne .Message "" }}
                <div>{{ .Message }}</div>
            {{ end }}
        </div>
    {{ end }}
</aside>

<script>
  function addLoading() {
    event.target.classList.add("is-loading");
  }

  function deleteDb() {
    return confirm("–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –±–∞–∑—É?");
  }

  const secured = document.querySelectorAll(`[data-secured]`);
  const inputs = document.querySelectorAll(`[type="hidden"][name="password"]`);

  function setPasswords() {
    const pass = event.target.value.trim();
    const ok = pass.length >= 8;
    secured.forEach(control => {
      if (ok) {
        control.removeAttribute("disabled");
      } else {
        control.setAttribute("disabled", "");
      }
    });
    inputs.forEach(input => {
      input.value = pass;
    });
  }
</script>

</body>
</html>
